# Finances Service

Консольное приложение для управления личными финансами с возможностью отслеживания доходов, расходов, установки бюджетов и совершения переводов между пользователями.

## Функциональность

-  Авторизация пользователей по логину и паролю
-  Управление категориями доходов и расходов
-  Установка и отслеживание бюджетов по категориям
-  Добавление финансовых операций
-  Просмотр детальной статистики и отчетов
-  Переводы между пользователями
-  Экспорт данных в CSV, JSON и текстовые форматы
-  Автоматические оповещения о превышении бюджетов
-  Сохранение и загрузка данных при входе/выходе

## Архитектура

Проект построен по принципу разделения на слои:

### Структура проекта

```
src/
├── main/java/
│   ├── Main.java                # Точка входа
│   ├── models/                  # Модели данных
│   │   ├── User.java                # Модель пользователя
│   │   ├── Wallet.java              # Модель кошелька
│   │   └── Category.java            # Модель категории
│   ├── services/                # Бизнес-сервисы
│   │   │── UsersService.java        # Управление пользователями
│   │   └── WalletService.java       # Управление кошельками
│   ├── storages/                # Персистентность
│   │   ├── Storage.java             # Интерфейс хранилища
│   │   ├── UsersStorage.java        # Хранилище пользователей
│   │   └── WalletStorage.java       # Хранилище кошельков
│   ├── security/                # Безопасность
│   │   └── PasswordHasher.java      # Хеширование паролей
│   ├── export/                  # Экспорт данных
│   │    └── DataExporter.java        # Экспорт в различные форматы
│   └── UI/                      # Пользовательский интерфейс
│       └── MenuService/
│           └── MenuService.java     # CLI меню
└── test/java/                   # Тесты (>15 тестов)
    ├── models/
    └── services/
```

### Ключевые решения

- **Разделение ответственности**: четкое разделение на слои (models, services, storage, UI)
- **Java Serialization**: для сохранения состояния кошельков и пользователей
- **Concurrent collections**: использование `ConcurrentHashMap` для потокобезопасности
- **Immutable модели**: `User` и частично `Category` неизменяемы
- **UUID для категорий**: уникальная идентификация с защитой от коллизий

## Установка и запуск

### Требования

- Java 11 или выше
- Maven 3.6+

### Способ 1 - через Maven

```bash
mvn clean package
java -jar target/finances-service-1.0.0.jar
```

### Способ 2 - ручная компиляция

```bash
javac -d out -sourcepath src/main/java src/main/java/Main.java
java -cp out Main
```

### Способ 3 - запуск через Maven

```bash
mvn clean compile
mvn exec:java -Dexec.mainClass="Main"
```

## Примеры команд

### Первый запуск - создание пользователя

```
Введите пару логин-пароль для авторизации... или нажмите Enter для создания нового:
[нажмите Enter]

Введите пару логин-пароль для создания пользователя:
admin qwerty123
```

### Создание категорий

```
Выберите действие: 1
Введите название категории: Зарплата
Введите '+' для дохода или '-' для расхода: +
✓ Добавлена категория дохода: Зарплата

Выберите действие: 1
Введите название категории: Еда
Введите '+' для дохода или '-' для расхода: -
✓ Добавлена категория расхода: Еда
```

### Установка бюджета

```
Выберите действие: 2
Введите название категории: Еда
Введите бюджет для категории: 5000
✓ Изменен бюджет для категории 'Еда': 5000
```

### Добавление операций

```
Выберите действие: 6
Введите название категории: Зарплата
Введите сумму операции: 50000
✓ Добавлена операция по категории: 'Зарплата' -> 50000

Выберите действие: 6
Введите название категории: Еда
Введите сумму операции: 1500
✓ Добавлена операция по категории: 'Еда' -> 1500
```

### Просмотр статистики

```
Выберите действие: 4

============================================================
ФИНАНСОВЫЙ ОТЧЕТ
============================================================

ДОХОДЫ:
------------------------------------------------------------
  Зарплата                                     50000
------------------------------------------------------------
  ИТОГО ДОХОДОВ:                               50000

РАСХОДЫ:
------------------------------------------------------------
  Еда                                 1500 (Остаток:     3500)
------------------------------------------------------------
  ИТОГО РАСХОДОВ:                               1500

============================================================
  ТЕКУЩИЙ БАЛАНС:                              48500
============================================================
```

### Экспорт данных

```
Выберите действие: 8
Выберите формат экспорта:
1. CSV (для Excel)
2. JSON (для программной обработки)
3. TXT (текстовый отчет)
[выберите формат]
✓ Данные экспортированы в файл: export_admin_1234567890.csv
```

### Перевод другому пользователю

```
Выберите действие: 7
Введите имя пользователя для отправки: user2
Введите сумму для отправки: 1000
✓ Совершен перевод пользователю 'user2' -> 1000
```

### Справка

```
Выберите действие: help
[отображается подробная справка по всем командам]
```

## Тестирование

### Запуск всех тестов

```bash
mvn test
```

### Запуск с отчетом о покрытии

```bash
mvn test
mvn surefire-report:report
```

### Тестовое покрытие

Проект содержит более 30 unit и интеграционных тестов:

- `UserTest` - тесты модели пользователя (3 теста)
- `CategoryTest` - тесты модели категории (8 тестов)
- `WalletTest` - тесты модели кошелька (15 тестов)
- `UsersServiceTest` - тесты сервиса пользователей (7 тестов)
- `WalletServiceTest` - тесты сервиса кошельков (4 теста)

## CI/CD

Проект настроен для автоматической сборки и тестирования через GitHub Actions:

- Автоматический запуск тестов при push/PR
- Сборка JAR артефакта
- Генерация отчетов о тестировании

См. `.github/workflows/maven.yml`

## Особенности реализации

### Безопасность

- Пароли хешируются перед сохранением (используется `hashCode()` - для production рекомендуется BCrypt)
- Валидация всех пользовательских вводов
- Защита системных категорий от изменения

### Оповещения

- Предупреждение при превышении бюджета категории
- Предупреждение при нулевом балансе
- Предупреждение когда расходы превышают доходы
- Все оповещения показываются в момент добавления операции и при просмотре статистики

### Персистентность

- Автоматическое сохранение после каждой операции
- Сохранение при выходе из приложения
- Загрузка данных при авторизации
- Файлы хранятся в директории `data/`

### UX

- Команда `help` с подробной справкой
- Форматированный вывод таблиц
- Понятные сообщения об ошибках
- Prompt с именем текущего пользователя
- Валидация с повторным запросом ввода

## Возможные улучшения

- [ ] Добавить даты для операций и фильтрацию по периодам
- [ ] Использовать BCrypt для хеширования паролей
- [ ] Добавить базу данных вместо файлового хранилища
